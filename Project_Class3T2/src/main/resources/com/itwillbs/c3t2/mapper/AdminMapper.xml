<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.itwillbs.c3t2.mapper.AdminMapper">
     <select id="selectMemberList" resultType="com.itwillbs.c3t2.vo.MemberVO">
			SELECT * FROM MEMBER
		</select>
		<select id="selectReservationList" resultType="map">
			SELECT rm.reservation_num
			,CONCAT(rs.reservation_date,'/',reservation_time) as reservation_date
			,ROW_NUMBER() OVER(order by reservation_num) as num
			,reservation_person_name
			,reservation_person_count
			,reservation_person_phone
			,reservation_cancel
			,reservation_is_member
			,reservation_guest_num
			,CONCAT(dinning_num,' 번 테이블') as dinning_num
			,restaurant_num
			FROM RESERVATION rm JOIN ( SELECT reservation_num,reservation_date
										FROM RESERVATION
										WHERE reservation_date > date_format(now(),'%Y-%m-%d')) rs
			ON rm.reservation_num = rs.reservation_num;
		</select>
		<select id="selectAdmin" resultType="com.itwillbs.c3t2.vo.AdminVO">
			SELECT *
			FROM ADMIN
			WHERE admin_id = #{admin_id}
		</select>
		<select id="selectNotice" resultType="map">
			SELECT  notice_num
				  , notice_subject
				  , notice_content
				  , notice_readcount
				  , DATE_FORMAT(notice_date, '%Y년 %m월%d일 %H:%i') as notice_date
				  , ROW_NUMBER() OVER(order by notice_num) as num
			FROM NOTICE
		</select>
		<select id="selectProduct" resultType="com.itwillbs.c3t2.vo.ProductVO">
			SELECT  *,ROW_NUMBER() OVER(order by product_num) as num
			FROM PRODUCT
			<if test="product_num != null">
				WHERE product_num = ${product_num}
			</if>
		</select>
		<select id="selectProductImg" resultType="map">
			SELECT *
			FROM PRODUCT_IMG
			WHERE product_num = ${product_num}
		</select>
		<insert id="insertProduct">
			INSERT INTO PRODUCT
			VALUES(null
					   ,#{product_name}
					   ,#{product_price}
					   ,#{product_info}
					   ,now()
					   ,#{product_category_num}
					   ,#{main_file_name}
					   ,#{upload_dir}
				 	 )
		</insert>
		<insert id="insertProductImg">
			<selectKey keyProperty="product_num" resultType="int" order="BEFORE">
				SELECT MAX(product_num)
				FROM PRODUCT
			</selectKey>
			INSERT INTO PRODUCT_IMG
			VALUES(	null
				   ,#{product_num}
				   ,#{info_file_name}
				   ,#{upload_dir}
				  )
		</insert>
		
		<delete id="deleteProductImg">
			DELETE FROM PRODUCT_IMG
			WHERE product_num = #{product_num};
		</delete>

		<delete id="deleteProduct">
			DELETE FROM PRODUCT
			WHERE product_num = #{product_num};
		</delete>
		<insert id="insertNotice">
		INSERT INTO NOTICE
		VALUES(	null
				, #{notice_subject}
				, #{notice_content}
				,now()
				,0
		)
		</insert>
		<delete id="deleteNotice">
		DELETE FROM NOTICE
		WHERE notice_num = #{notice_num}
		</delete>
		<select id="selectReviewList" resultType="map">
			SELECT review_num
				, ROW_NUMBER() OVER(order by review_num) as num
				, review_content
				, order_num
				, r.product_num
				, product_name
				, review_star
				, DATE_FORMAT(review_date, '%Y년 %m월%d일 %H:%i') as review_date
				, member_id
				, review_image
			FROM REVIEW r JOIN PRODUCT p
			ON r.product_num = p.product_num
		</select>
		<select id="selectReviewImg" resultType="map">
			SELECT review_image
			FROM REVIEW
			WHERE review_num = #{review_num}
		</select>
		<select id="selectEventList" resultType="map">
			SELECT event_num
				, ROW_NUMBER() OVER(order by event_num) as num
				, DATE_FORMAT(event_date, '%Y년 %m월%d일 %H:%i') as event_date
				, event_subject
				, event_content
				, event_image
				, event_image_real_file
			FROM EVENT
		</select>
		<select id="selectEvent" resultType="map">
			SELECT event_image
			FROM EVENT
			WHERE event_num = #{event_num}
		</select>
		<delete id="deleteEvent">
				DELETE FROM EVENT
				WHERE event_num = #{event_num}
		</delete>
		<delete id="deleteReview">
				DELETE FROM REVIEW
				WHERE review_num = #{review_num} 
		</delete>
		<insert id="insertEvent">
			INSERT INTO EVENT
			VALUES(null
				, #{event_subject}
				, #{event_content}
				, now()
				, #{event_img}
				, #{event_image_real_file}
				)
		</insert>
		<select id="selectQnaBoardList" resultType="map">
			SELECT qna_num
				,ROW_NUMBER() OVER(order by qna_num) as num
				,product_num
				,q.member_id as member_id
				,member_name
				,qna_answer
				,IF(ISNULL(qna_answer),'답변대기','답변완료') as qna_is_answer
				,DATE_FORMAT(qna_date, '%Y년 %m월%d일 %H:%i') as qna_date
				,qna_subject
				,qna_content
			FROM QNA q join MEMBER m
			on q.member_id = m.member_id
			WHERE qna_date > DATE_FORMAT(now(), '%Y년')
		</select>
		<select id="selectQnaBoard" resultType="map">
			SELECT qna_num
				,ROW_NUMBER() OVER(order by qna_num) as num
				,q.product_num
				,product_name
				,m.member_id
				,member_name
				,qna_answer
				,IF(ISNULL(qna_answer),'답변대기','답변완료') as qna_is_answer
				,DATE_FORMAT(qna_date, '%Y년 %m월%d일 %H:%i') as qna_date
				,qna_subject
				,qna_content
			FROM QNA  q JOIN MEMBER m
			ON q.member_id = m.member_id 
			JOIN PRODUCT p
			ON p.product_num = q.product_num
			WHERE qna_num= #{qna_num}
		</select>
		<update id="updateQnaBoard">
			update QNA
			set qna_answer = #{qna_answer}
			where qna_num = #{qna_num}
		</update>
<!-- 		<select id="selectProductByImg" resultType="map"> -->
<!-- 			SELECT cast(p.product_num as CHAR(10)) as  product_num -->
<!-- 				, p.product_name -->
<!-- 				, p.product_price -->
<!-- 				, p.product_info -->
<!-- 				, p.product_release -->
<!-- 				, p.product_category_num -->
<!-- 				, p.product_main_img -->
<!-- 				, p.product_main_img_real_file -->
<!-- 				 , i.product_image_num -->
<!-- 			     , i.product_image -->
<!-- 			     , i.product_image_real_file -->
<!-- 			  FROM PRODUCT p -->
<!-- 			  JOIN PRODUCT_IMG i -->
<!-- 				ON p.product_num = i.product_num -->
<!-- 			 WHERE p.product_num = ${product_num} -->
<!-- 		</select> -->
    </mapper>